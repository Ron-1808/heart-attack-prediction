import streamlit as st
import pandas as pd
import numpy as np
import joblib

st.set_page_config(
    page_title="Heart Disease Prediction",
    page_icon="‚ù§Ô∏è",
    layout="wide"
)


st.title("‚ù§Ô∏è Heart Disease Prediction System")
st.caption("AI-powered tool to assess heart disease risk")

st.divider()

col1, col2 = st.columns(2)

with col1:
    st.subheader("üìå About This App")
    st.info(
        """
        ‚Ä¢ Uses Machine Learning (KNN)  
        ‚Ä¢ Trained on real heart disease dataset  
        ‚Ä¢ Helps identify risk levels early  
        ‚Ä¢ Educational & research purpose  
        """
    )

with col2:
    st.subheader("ü§ñ Model Information")
    st.success(
        """
        **Algorithm:** K-Nearest Neighbors  
        **Scaling:** StandardScaler  
        **Output:** Heart Disease Risk (Yes / No)
        """
    )

st.divider()


model = joblib.load("KNN_heart.pkl")
scaler = joblib.load("scaler.pkl")
expected_columns = joblib.load("columns.pkl")


st.subheader("ü©∫ Patient Details")

with st.container():
    colA, colB, colC = st.columns(3)

    with colA:
        age = st.slider("Age", 18, 100, 45)
        sex = st.selectbox("Sex", ["M", "F"])
        chest_pain = st.selectbox(
            "Chest Pain Type",
            ["ATA", "NAP", "TA", "ASY"]
        )

    with colB:
        resting_bp = st.number_input(
            "Resting Blood Pressure (mm Hg)",
            80, 200, 120
        )
        cholesterol = st.number_input(
            "Cholesterol (mg/dL)",
            100, 600, 200
        )
        fasting_bs = st.selectbox(
            "Fasting Blood Sugar > 120 mg/dL",
            [0, 1]
        )

    with colC:
        max_hr = st.slider(
            "Maximum Heart Rate",
            60, 220, 150
        )
        exercise_angina = st.selectbox(
            "Exercise-Induced Angina",
            ["Y", "N"]
        )
        oldpeak = st.slider(
            "Oldpeak (ST Depression)",
            0.0, 6.0, 1.0
        )
        st_slope = st.selectbox(
            "ST Slope",
            ["Up", "Flat", "Down"]
        )

st.divider()

if st.button("üîç Predict Heart Disease Risk", use_container_width=True):

    raw_input = {
        "Age": age,
        "RestingBP": resting_bp,
        "Cholesterol": cholesterol,
        "FastingBS": fasting_bs,
        "MaxHR": max_hr,
        "Oldpeak": oldpeak,
        f"Sex_{sex}": 1,
        f"ChestPainType_{chest_pain}": 1,
        f"ExerciseAngina_{exercise_angina}": 1,
        f"ST_Slope_{st_slope}": 1
    }

    input_df = pd.DataFrame([raw_input])

    for col in expected_columns:
        if col not in input_df.columns:
            input_df[col] = 0

    input_df = input_df[expected_columns]
    scaled_input = scaler.transform(input_df)
    prediction = model.predict(scaled_input)[0]

    if prediction == 1:
        st.error("üö® **High Risk of Heart Disease**")
    else:
        st.success("‚úÖ **Low Risk of Heart Disease**")

st.divider()
st.caption("Developed by L | Machine Learning Project")
